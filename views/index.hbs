<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>βεκος</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w"
        crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.8/howler.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nanoajax/0.4.3/nanoajax.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <script src="/libraries/jquery-3.3.1.js"></script>
    <script src="/libraries/flying_bread.js"></script>
</head>

<body>

    <script>
        function isEmpty(str) {
            return (!str || 0 === str.length || str=="null");
        }
        function change_name(){
            var repeat = true;
            name = ""
            while (repeat) {
                name = prompt("ονομα;");
                if (!isEmpty(name)) {
                    repeat = false;
                }
            }
            Cookies.set("name", name, { expires: 30 });
        }
        if (Cookies.get("name")){
            var name = Cookies.get("name")
        } else {
            change_name()
        }
        var audios = []
        nanoajax.ajax({url:'/audio?format=json'}, function (code, responseText) {
            if (code == 200) {
                var paths = JSON.parse(responseText);
                for (var i = 0;i<paths.length;i++) {
                    audios.push(new Howl({
                        src: [paths[i]]
                    }));
                }
            }
        })
        var sound = new Howl({
            //src: ['assets/alert.mp3']
            src: ['assets/Bekos.mp3'] 
        });

        var play_sound = function () {
            console.log("bekos");
            sound.play();
        };

        var socket = io();

        function broadcast_sound() {
            socket.emit('BEKOS', name);
        }

        socket.on("BEEKOS", function (msg) {
            console.log(msg)
            document.getElementById("message").innerText = msg.message
            if (audios.length > 0) {
                audios[msg.sound].play()
            } else {
                sound.play();
            }
        })

        


    </script>
        <div class="big-container background-breathe" id="main">
            <div class="action-bread">
                <button onclick="broadcast_sound(); bread_will_fly();" style="visibility: hidden">
                    <img id="bekosImage" src="/assets/uberbekos.png" class="pure-img bread grow"  style="visibility: visible">
                </button>
            <h1 class="splash-head">βεκος</h1>
            <p class="splash-subhead" id="message">
                Welcome to βεκος
            </p>
            <p>
                <button onclick="broadcast_sound(); bread_will_fly();" class="pure-button pure-button-primary grow">
                    <span class="text-breathe">βεκος</span>
                </button>
            </p>
            </div>
            <a onclick="change_name()" class="splash-subhead grow" id="changename">νεον ονομα</a>
            <a href="https://en.wikipedia.org/wiki/Phrygian_language" class="splash-subhead grow" id="question">βεκος;</a>
        
        </div>

</body>

</html>